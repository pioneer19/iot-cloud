### автозапуск скриптов MQTT внутри виртуалки
Thu, 10 Dec 2020 18:31:36 +0300
* сделал задержку в 200ms на запись журнала в influxdb 
  (был sync после каждой записи в файл журнала)   
  (wal-fsync-delay = "200ms" в конфиге influx)
* рестартанул influx (reload он не умеет)
* рестартанул скрипт на питоне (он упал при рестарте influx)
---
Все до этого к автозапуску не имеет отношения.
* создал unit file для systemd /lib/systemd/system/mqtt-client.service
* systemctl enable mqtt-client
* systemctl start mqtt-client

Думаю, теперь оно запустится при перезагрузке (не проверял).
influx теперь пишет данные в журнал пачками (ждет 200ms и
записывает оптом). Нагрузка на диск уменьшилась.
Т.е. при внезапном падении машины данные за <=200 ms потеряются
(думаю вам это не важно).

С тормозами графаны и других буду разбираться потом.

Mon, 14 Dec 2020 18:33:11 +0300

* вынес файлы influxbd (/var/lib/influxdb) на отдельную шару vboxfs
* перезапустил вартуалку на 4-х CPU (работала на одном)

Wed, 15 Dec 2020

* обновил пакеты внутри виртуалки и на машине
* исправил запуск mqtt клиента, который перестал работать
* исправил запуск mosquitto, который не смог создать Pid file

Wed, 16 Dec 2020 17:34:47 +0300
* настроил автозапуск виртуалок на хосте (машине).
* остановил запуск vboxWebService, который также не смог
  создать Pid файл и в результате не работает. Он не нужен.
* удалил mosquitto из виртуалки.

Wed Dec 30 21:00:00 MSK 2020
* переразбил диск, добавил ssd в качестве кеша для фаловой системы на `/home`
  (по сути, все данные помещаются на ssd и практически всегда работа будет
  со скоростью ssd, при этом размер диска - размер HDD)
* перенес influx и grafana в контейнеры docker на хостовой машине 
  (теперь виртуализация их никак не тормозит).
  
Описание работы с [docker](./about_docker.md) и конкретные [команды для работы
с контейнерами](./IoT.md).